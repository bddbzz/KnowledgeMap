# Node

## 简介

Node 的作者 Ryan Dahl 是一名资深的 C/C++程序员，他总结出设计高性能的 Web 服务器的要点：事件驱动、非阻塞 I/O，考虑到高性能（V8）、事件驱动、没有历史包袱，JavaScript 成为了 Node 的实现语言，一开始他只想开发一个 Web 服务器，但是项目的发展超出了他的预期，它逐步变成了构建网络应用的基础框架，可以以此为基础构建更多东西，诸如服务端、客户端、命令行工具等。

Node 发展为一个强制不共享任何资源的单线程、单进程系统，包含十分适宜网络的库，为构建大型分布式应用程序提供基础设施，其目标也是成为一个构建快速、可伸缩的网络应用平台。它自身非常简单，通过通信协议来组织许多 Node，非常容易通过扩展来达成构建大型网络应用的目的。每一个 Node 进程都构成这个网络应用中的一个节点，这是它名字所含意义的真谛。

## Node 技术栈

V8/libuv/Node:通过 libuv 实现跨平台架构，第三方 C++模块也可以借助 libuv 实现跨平台
底层知识：C/C++/操作系统/网络
应用技能：Electron/NW
对比学习：Chromium/Webkit

## Node 的应用场景

-   I/O 密集型
-   CPU 密集型
    CPU 密集型应用给 Node 带来的挑战主要是：由于 JavaScript 单线程的原因，如果有长时间运行的计算（比如大循环），将会导致 CPU 时间片不能释放，使得后续的 I/O 无法发起，
-   Node 虽然没有提供多线程用于计算支持，但还是有两个方式来充分利用 CPU
-   C/C++扩展
-   子进程
-   与遗留系统和平共处
-   分布式应用

## 特点

-   异步 I/O
-   事件与回调函数
-   单线程
-   优点：不用像多线程编程那样处处在意状态的同步问题，这里没有死锁的存在，也没有线程上下文交换所带来的性能上的开销
-   缺点：无法利用多核 CPU、错误会引起整个应用退出，应用的健壮性值得考验、大量计算占用 CPU 导致无法继续调用异步 I/O
-   Node child_process，子进程的出现，意味着 Node 可以从容地应对单线程在健壮性和无法利用多核 CPU 方面的问题。通过将计算分发到各个子进程，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果，这可以很好地保持应用模型的简单和低依赖。通过 Master-Worker 的管理方式，也可以很好地管理各个工作进程，以达到更高的健壮性。

## 模块机制

-   CommonJS 模块规范
-   模块实现
-   路径分析
-   文件定位
-   编译执行
-   模块类型
-   核心模块（Node 进程启动时，部分核心模块就被直接加载进内存中，所以这部分核心模块引入时，文件定位和编译执行这两个步骤可以省略掉，并且在路径分析中优先判断，所以它的加载速度是最快的。）
-   文件模块
-   特点
-   优先从缓存加载，Node 是缓存编译、执行后的对象
-   不同模块的文件的编译
-   JavaScript 模块的编译
    Node 对获取的 JavaScript 文件内容进行了头尾包装，这样每个模块文件之间都进行了作用域隔离。包装之后的代码会通过 vm 原生模块的 runInThisContext()方法执行（类似 eval，只是具有明确上下文，不污染全局），返回一个具体的 function 对象。

## 异步 IO

## 异步编程

## 内存控制

## 网络编程

## 进程

## 测试

## 产品化
